<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="kr.or.bus.dao.CommuteDAO">
	<!-- 출/퇴근 표준 시간 -->
	<select id="getStandardTime" resultType = "kr.or.bus.dto.CstandardDTO">
		select cs_ams, cs_ame, cs_pms, cs_pme
		from cstandard
	</select>

	<!-- 회원의 출/퇴근 정보 조회 -->
 	<select id="getSelect" resultType="kr.or.bus.dto.CommuteJoinCstartJoinCendDTO" parameterType="String">
		select * from 
			(select rownum, N.*
			 from (
			 		select c_date, c_start, c_end 
			 		from commute
			 		where m_id= #{param3} order by c_date desc
			 	   )N
			 )where rownum between 1 + (#{param1}-1) * 5 and 5 + (#{param1}-1)*10
	</select>
	
	<insert id="insertCommuteInfo" parameterType = "String">
		insert into commute(m_id,m_name,c_date,c_start) values (#{param1}, #{param2}, sysdate+9/24, sysdate+9/24)
	</insert>
	


		
		<update id="csupdate" parameterType="String">
		update commute set cs_code='1'	
		
		where m_id=#{m_id} and c_time='am'
		
		</update>
		
	
	
	
	<select id="csselect"  parameterType="String" resultType = "kr.or.bus.dto.CommuteJoinCstartJoinCendDTO">
		select c_start, cs_stat
		from commute com join cstart cs on com.cs_code=cs.cs_code
		where m_id=#{m_id}
	</select>
	
	<update id="csudate">
		update commute set cs_code = '1' where c_time = 'am' and m_id = #{m_id}
	</update>
	
	<!-- 회원의 퇴근시간 -->
	<!-- offinsertCommuteInfo -->
	
	<update id="ceupdate">
	update commute 
	<set>
		<choose>
			<when test="c_time='am' and c_end &lt; '1800'">
			ce_code='2'
			</when>		
			<when test="c_time='am' and c_end &gt; '1800'">
			ce_code='1'
			</when>
			<when test="c_time='pm' and c_end &gt; '2300'">
			ce_code='1'
			</when>
			<when test="c_time='pm' and c_end &lt; '2300'">
			ce_code='2'
			</when>
		</choose>
	</set>	
	where m_id=#{m_id}
	</update>
 	
	<select id="ceselect"  resultType = "kr.or.bus.dto.CommuteJoinCstartJoinCendDTO">
		select c_end, ce_stat
		from commute com join cend ce on com.ce_code=ce.ce_code
		where m_id=#{m_id}
	</select>
	
	<select id="getOnlyName" parameterType="String" resultType="String">
		select m_name
		from member 
		where m_id = #{m_id}
	</select>
	
</mapper>


