<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="kr.or.bus.dao.CommuteDAO">
	<!-- 출/퇴근 표준 시간 -->
	<select id="getStandardTime" resultType = "kr.or.bus.dto.CstandardDTO">
		select cs_ams, cs_ame, cs_pms, cs_pme
		from cstandard
	</select>

	<!-- 회원의 출/퇴근 정보 조회 -->
 	<select id="getSelect" resultType="kr.or.bus.dto.CommuteJoinCstartJoinCendDTO" parameterType="String">
		select * from 
			(select rownum, N.*
			 from (
			 		select c_date, c_start, c_end 
			 		from commute
			 		where m_id= #{param3} order by c_date desc
			 	   )N
			 )where rownum between 1 + (#{param1}-1) * 5 and 5 + (#{param1}-1)*10
	</select>
	
	<!-- 회원의 출근시간  -->
	<!-- <update id="csupdate">
	update commute 
	<set>
		<choose>
			<when test="c_time='am' and c_start &gt; '0900'">
			cs_code='2'
			</when>		
			<when test="c_time='am' and c_start &lt; '0900'">
			cs_code='1'
			</when>
			<when test="c_time='pm' and c_start &lt; '1300'">
			cs_code='1'
			</when>
			<when test="c_time='pm' and c_start &gt; '1300'">
			cs_code='2'
			</when>
		</choose>
	</set>	
	where m_id=#{m_id}
	</update> -->
	<insert id="insertCommuteInfo" parameterType = "String">
		insert into commute(m_id,m_name,c_date,c_start) values (#{param1}, #{param2}, sysdate+9/24, sysdate+9/24)
	</insert>
	
	<update id="csupdate">
<!-- 	UPDATE AUTHOR
	<trim prefix="SET" suffixOverrides=",">
		<if test="username != null">username=#{username},</if>
		<if test="password != null">password=#{password},</if>
		<if test="email != null">email=#{email},</if>
		<if test="bio != null">bio=#{bio},</if>
	</trim>
WHERE id=#{id} -->



		<!-- update commute
		<trim prefix="set" suffixOverrides="to_char">
			<choose>
			<when test="(c_start,'HH24MI') &gt; '0930' and C_TIME = 'am'">
			cs_code='2'			
			</when>	
			<when test="(c_start,'HH24MI') &lt; '0930' and C_TIME = 'am'">
			cs_code='1'
			</when>
			<when test="(c_start,'HH24MI') &lt; '1800' and C_TIME = 'pm'">
			cs_code='1'
			</when>
			<when test="(c_start,'HH24MI') &gt; '1800' and C_TIME = 'pm'">
			cs_code='2'
			</when>
		</choose>
		where m_id=#{m_id} and to_char(c_date,'yyyy-mm-dd') = to_char(sysdate,'yyyy-mm-dd')
		</trim> -->
		
		
		update commute
		<trim prefix="set">
			<choose>
			<when test="c_start.toString() &gt; '0930' and C_TIME = 'am'">
			cs_code='2'			
			</when>	
			<when test="c_start.toString() &lt; '0930' and C_TIME = 'am'">
			cs_code='1'
			</when>
			<when test="c_start.toString() &lt; '1800' and C_TIME = 'pm'">
			cs_code='1'
			</when>
			<when test="c_start.toString() &gt; '1800' and C_TIME = 'pm'">
			cs_code='2'
			</when>
		</choose>
		where m_id=#{m_id} and to_char(c_date,'yyyy-mm-dd') = to_char(sysdate,'yyyy-mm-dd')
		</trim>
		
		</update>
		
	
	<!-- <trim prefix="set" prefixOverrides="to_char()">
	update commute 
	<set>
		<choose>
			<when test="to_char(c_start,'HH24MI') &gt; '0930' and C_TIME = 'am'">
			cs_code='2'			
			</when>	
			<when test="to_char(c_start,'HH24MI') &lt; '0930' and C_TIME = 'am'">
			cs_code='1'
			</when>
			<when test="to_char(c_start,'HH24MI') &lt; '1800' and C_TIME = 'pm'">
			cs_code='1'
			</when>
			<when test="to_char(c_start,'HH24MI') &gt; '1800' and C_TIME = 'pm'">
			cs_code='2'
			</when>
		</choose>
	</set>	
	where m_id=#{m_id} and to_char(c_date,'yyyy-mm-dd') = to_char(sysdate,'yyyy-mm-dd')
	</trim> -->

	
	<select id="csselect"  resultType = "kr.or.bus.dto.CommuteJoinCstartJoinCendDTO">
		select c_start, cs_stat
		from commute com join cstart cs on com.cs_code=cs.cs_code
		where m_id=#{m_id}
	</select>
	
	<!-- 회원의 퇴근시간 -->
	<!-- offinsertCommuteInfo -->
	
	<update id="ceupdate">
	update commute 
	<set>
		<choose>
			<when test="c_time='am' and c_end &lt; '1800'">
			ce_code='2'
			</when>		
			<when test="c_time='am' and c_end &gt; '1800'">
			ce_code='1'
			</when>
			<when test="c_time='pm' and c_end &gt; '2300'">
			ce_code='1'
			</when>
			<when test="c_time='pm' and c_end &lt; '2300'">
			ce_code='2'
			</when>
		</choose>
	</set>	
	where m_id=#{m_id}
	</update>
 	
	<select id="ceselect"  resultType = "kr.or.bus.dto.CommuteJoinCstartJoinCendDTO">
		select c_end, ce_stat
		from commute com join cend ce on com.ce_code=ce.ce_code
		where m_id=#{m_id}
	</select>
	
	<select id="getOnlyName" parameterType="String" resultType="String">
		select m_name
		from member 
		where m_id = #{m_id}
	</select>
	
</mapper>


